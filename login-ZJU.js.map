{
  "version": 3,
  "sources": ["../src/utils/cookie-jar.ts", "../src/utils/fetch-utils.ts", "../src/courses.ts", "../src/zdbk.ts", "../src/utils/RSA.ts", "../src/zjuam.ts", "../src/course.ts", "../src/form.ts", "../src/classroom.ts"],
  "sourcesContent": ["// TypeScript refactor of the original cookie-jar implementation.\r\n// The file exposes three exported classes: CookieAccessInfo, Cookie, CookieJar\r\n\r\nexport class CookieAccessInfo {\r\n    domain?: string;\r\n    path: string;\r\n    secure: boolean;\r\n    script: boolean;\r\n\r\n    static All: any = Object.freeze(Object.create(null));\r\n\r\n    constructor(domain?: string, path?: string, secure?: boolean, script?: boolean) {\r\n        this.domain = domain || undefined;\r\n        this.path = path || \"/\";\r\n        this.secure = !!secure;\r\n        this.script = !!script;\r\n    }\r\n}\r\n\r\nconst cookie_str_splitter = /[:](?=\\s*[a-zA-Z0-9_\\-]+\\s*[=])/g;\r\n\r\nexport class Cookie {\r\n    name: string | null = null;\r\n    value: string | null = null;\r\n    expiration_date: number = Infinity;\r\n    path: string = \"/\";\r\n    explicit_path: boolean = false;\r\n    domain: string | null = null;\r\n    explicit_domain: boolean = false;\r\n    secure: boolean = false;\r\n    noscript: boolean = false; // httponly\r\n\r\n    constructor(cookiestr?: string | Cookie, request_domain?: string | null, request_path?: string) {\r\n        if (cookiestr instanceof Cookie) {\r\n            // clone\r\n            Object.assign(this, cookiestr);\r\n            return;\r\n        }\r\n        this.path = String(request_path || \"/\");\r\n        this.domain = request_domain || null;\r\n        if (cookiestr) {\r\n            this.parse(cookiestr as string, request_domain, request_path);\r\n        }\r\n    }\r\n\r\n    toString(): string {\r\n        const str: string[] = [this.name + \"=\" + this.value];\r\n        if (this.expiration_date !== Infinity) {\r\n            str.push(\"expires=\" + new Date(this.expiration_date).toUTCString());\r\n        }\r\n        if (this.domain) {\r\n            str.push(\"domain=\" + this.domain);\r\n        }\r\n        if (this.path) {\r\n            str.push(\"path=\" + this.path);\r\n        }\r\n        if (this.secure) {\r\n            str.push(\"secure\");\r\n        }\r\n        if (this.noscript) {\r\n            str.push(\"httponly\");\r\n        }\r\n        return str.join(\"; \");\r\n    }\r\n\r\n    toValueString(): string {\r\n        return this.name + \"=\" + this.value;\r\n    }\r\n\r\n    parse(str: string, request_domain?: string | null, request_path?: string): this | undefined {\r\n        if (typeof str !== 'string') return undefined;\r\n        if (str.length > 32768) {\r\n            console.warn(\"Cookie too long for parsing (>32768 characters)\");\r\n            return undefined;\r\n        }\r\n\r\n        const parts = str.split(\";\").filter(Boolean);\r\n        const firstPair = parts[0].match(/([^=]+)=([\\s\\S]*)/);\r\n        if (!firstPair) {\r\n            console.warn(\"Invalid cookie header encountered. Header: '\" + str + \"'\");\r\n            return undefined;\r\n        }\r\n\r\n        let key = firstPair[1];\r\n        let value = firstPair[2];\r\n        if (typeof key !== 'string' || key.length === 0 || typeof value !== 'string') {\r\n            console.warn(\"Unable to extract values from cookie header. Cookie: '\" + str + \"'\");\r\n            return undefined;\r\n        }\r\n\r\n        this.name = key;\r\n        this.value = value;\r\n\r\n        for (let i = 1; i < parts.length; i += 1) {\r\n            const pair = parts[i].match(/([^=]+)(?:=([\\s\\S]*))?/);\r\n            if (!pair) continue;\r\n            key = pair[1].trim().toLowerCase();\r\n            value = pair[2];\r\n            switch (key) {\r\n                case \"httponly\":\r\n                    this.noscript = true;\r\n                    break;\r\n                case \"expires\":\r\n                    this.expiration_date = value ? Number(Date.parse(value)) : Infinity;\r\n                    break;\r\n                case \"path\":\r\n                    this.path = value ? value.trim() : \"\";\r\n                    this.explicit_path = true;\r\n                    break;\r\n                case \"domain\":\r\n                    this.domain = value ? value.trim() : \"\";\r\n                    this.explicit_domain = !!this.domain;\r\n                    break;\r\n                case \"secure\":\r\n                    this.secure = true;\r\n                    break;\r\n            }\r\n        }\r\n\r\n        if (!this.explicit_path) {\r\n            this.path = request_path || \"/\";\r\n        }\r\n        if (!this.explicit_domain) {\r\n            this.domain = request_domain || this.domain;\r\n        }\r\n\r\n        return this;\r\n    }\r\n\r\n    matches(access_info: CookieAccessInfo | any): boolean {\r\n        if (access_info === CookieAccessInfo.All) {\r\n            return true;\r\n        }\r\n        if ((this.noscript && access_info.script) || (this.secure && !access_info.secure) || !this.collidesWith(access_info)) {\r\n            return false;\r\n        }\r\n        return true;\r\n    }\r\n\r\n    collidesWith(access_info: CookieAccessInfo | any): boolean {\r\n        if ((this.path && !access_info.path) || (this.domain && !access_info.domain)) {\r\n            return false;\r\n        }\r\n        if (this.path && access_info.path.indexOf(this.path) !== 0) {\r\n            return false;\r\n        }\r\n        if (this.explicit_path && access_info.path.indexOf(this.path) !== 0) {\r\n            return false;\r\n        }\r\n\r\n        const access_domain = access_info.domain && access_info.domain.replace(/^[\\.]/, '');\r\n        const cookie_domain = this.domain && this.domain.replace(/^[\\.]/, '');\r\n        if (cookie_domain === access_domain) {\r\n            return true;\r\n        }\r\n        if (cookie_domain) {\r\n            if (!this.explicit_domain) {\r\n                return false; // already checked exact match above\r\n            }\r\n            const wildcard = access_domain.indexOf(cookie_domain);\r\n            if (wildcard === -1 || wildcard !== access_domain.length - cookie_domain.length) {\r\n                return false;\r\n            }\r\n            return true;\r\n        }\r\n        return true;\r\n    }\r\n}\r\n\r\nexport class CookieJar {\r\n    private cookies: Record<string, Cookie[]>;\r\n\r\n    constructor() {\r\n        this.cookies = Object.create(null);\r\n    }\r\n\r\n    setCookie(cookie: string | Cookie, request_domain?: string | null, request_path?: string): Cookie | Cookie[] | false {\r\n        const c = cookie instanceof Cookie ? cookie : new Cookie(cookie as string, request_domain, request_path);\r\n        const remove = c.expiration_date <= Date.now();\r\n        const name = c.name as string;\r\n\r\n        const existing = this.cookies[name];\r\n        if (existing !== undefined) {\r\n            for (let i = 0; i < existing.length; i += 1) {\r\n                const collidable_cookie = existing[i];\r\n                if (collidable_cookie.collidesWith(c)) {\r\n                    if (remove) {\r\n                        existing.splice(i, 1);\r\n                        if (existing.length === 0) {\r\n                            delete this.cookies[name];\r\n                        }\r\n                        return false;\r\n                    }\r\n                    existing[i] = c;\r\n                    return c;\r\n                }\r\n            }\r\n            if (remove) {\r\n                return false;\r\n            }\r\n            existing.push(c);\r\n            return c;\r\n        }\r\n\r\n        if (remove) {\r\n            return false;\r\n        }\r\n        this.cookies[name] = [c];\r\n        return this.cookies[name];\r\n    }\r\n\r\n    // returns a cookie\r\n    getCookie(cookie_name: string, access_info: CookieAccessInfo | any): Cookie | undefined {\r\n        const list = this.cookies[cookie_name];\r\n        if (!list) return undefined;\r\n        for (let i = 0; i < list.length; i += 1) {\r\n            const cookie = list[i];\r\n            if (cookie.expiration_date <= Date.now()) {\r\n                // removal behavior: if expired, skip (and allow eventual cleanup)\r\n                if (list.length === 0) {\r\n                    delete this.cookies[cookie.name as string];\r\n                }\r\n                continue;\r\n            }\r\n            if (cookie.matches(access_info)) {\r\n                return cookie;\r\n            }\r\n        }\r\n        return undefined;\r\n    }\r\n\r\n    // returns a list of cookies\r\n    getCookies(access_info: CookieAccessInfo | any): Cookie[] & { toString?: () => string; toValueString?: () => string } {\r\n        const matches: Cookie[] & any = [];\r\n        for (const cookie_name in this.cookies) {\r\n            const cookie = this.getCookie(cookie_name, access_info);\r\n            if (cookie) matches.push(cookie);\r\n        }\r\n        matches.toString = function toString() {\r\n            return matches.join(\":\");\r\n        };\r\n        matches.toValueString = function toValueString() {\r\n            return matches.map(function (c: Cookie) {\r\n                return c.toValueString();\r\n            }).join('; ');\r\n        };\r\n        return matches;\r\n    }\r\n\r\n    // returns list of cookies that were set correctly. Cookies that are expired and removed are not returned.\r\n    setCookies(cookies: string | string[] | Cookie[], request_domain?: string | null, request_path?: string): Cookie[] {\r\n        const items = Array.isArray(cookies) ? cookies : (cookies as string).split(cookie_str_splitter);\r\n        const successful: Cookie[] = [];\r\n        const prepared = items.map((item: any) => (item instanceof Cookie ? item : new Cookie(item, request_domain, request_path)));\r\n        for (let i = 0; i < prepared.length; i += 1) {\r\n            const cookie = prepared[i];\r\n            if (this.setCookie(cookie, request_domain, request_path)) {\r\n                successful.push(cookie);\r\n            }\r\n        }\r\n        return successful;\r\n    }\r\n}\r\n", "import { CookieJar, CookieAccessInfo } from './cookie-jar';\r\n\r\n/**\r\n * Simple fetch wrapper that injects cookies from a CookieJar and stores Set-Cookie headers back.\r\n * Usage:\r\n *   const jar = createCookieJar();\r\n *   const res = await fetchWithCookie('https://example.com/path', { method: 'GET' }, jar);\r\n */\r\nexport function createCookieJar(): CookieJar {\r\n    return new CookieJar();\r\n}\r\n\r\nfunction headersToObject(headers: HeadersInit | undefined): Record<string, string> {\r\n    const out: Record<string, string> = {};\r\n    if (!headers) return out;\r\n    if (headers instanceof Headers) {\r\n        for (const [k, v] of headers.entries()) out[k.toLowerCase()] = v;\r\n        return out;\r\n    }\r\n    if (Array.isArray(headers)) {\r\n        for (const [k, v] of headers) out[k.toLowerCase()] = v as string;\r\n        return out;\r\n    }\r\n    for (const k of Object.keys(headers)) {\r\n        const val = (headers as any)[k];\r\n        out[k.toLowerCase()] = String(val);\r\n    }\r\n    return out;\r\n}\r\n\r\nexport async function fetchWithCookie(input: RequestInfo, init?: RequestInit, jar?: CookieJar): Promise<Response> {\r\n    const cookieJar = jar || createCookieJar();\r\n\r\n    // Resolve URL and access info\r\n    const url = typeof input === 'string' ? input : input instanceof Request ? input.url : String(input);\r\n    const parsed = new URL(url, 'http://localhost');\r\n    const domain = parsed.hostname;\r\n    const path = parsed.pathname || '/';\r\n\r\n    // Prepare headers\r\n    const providedHeaders = headersToObject(init && init.headers ? init.headers : undefined);\r\n\r\n    // Get cookies matching this access info\r\n    const access = new CookieAccessInfo(domain, path, parsed.protocol === 'https:', false);\r\n    const cookies = cookieJar.getCookies(access);\r\n    const cookieHeader = (cookies && (cookies as any).toValueString) ? (cookies as any).toValueString() : (cookies.length ? cookies.map(c => c.toValueString()).join('; ') : '');\r\n\r\n    if (cookieHeader) {\r\n        // merge with existing cookie header if present\r\n        const existing = providedHeaders['cookie'];\r\n        providedHeaders['cookie'] = existing ? (existing + '; ' + cookieHeader) : cookieHeader;\r\n    }\r\n\r\n    // Rebuild Headers for fetch\r\n    const headers = new Headers();\r\n    for (const k of Object.keys(providedHeaders)) {\r\n        headers.set(k, providedHeaders[k]);\r\n    }\r\n\r\n    const finalInit: RequestInit = Object.assign({}, init, { headers });\r\n\r\n    const res = await fetch(input, finalInit);\r\n\r\n    // Collect Set-Cookie headers (there may be multiple)\r\n    const setCookies: string[] = [];\r\n    // Headers implements iterable of [name, value]\r\n    for (const [name, value] of res.headers) {\r\n        if (name.toLowerCase() === 'set-cookie') {\r\n            // value should be a single Set-Cookie string; if multiple Set-Cookie headers present they appear as separate iterations\r\n            setCookies.push(value);\r\n        }\r\n    }\r\n\r\n    if (setCookies.length > 0) {\r\n        // Add cookies back to jar\r\n        for (const sc of setCookies) {\r\n            try {\r\n                cookieJar.setCookies(sc, domain, path);\r\n            } catch (e) {\r\n                // swallow errors from cookie parsing\r\n                // keep best-effort behavior\r\n                // eslint-disable-next-line no-console\r\n                console.warn('Failed to set cookie from header', sc, e);\r\n            }\r\n        }\r\n    }\r\n\r\n    return res;\r\n}\r\n\r\nexport default fetchWithCookie;\r\n", "import fetchWithCookie, { createCookieJar } from \"./utils/fetch-utils\";\r\nimport { CookieAccessInfo } from \"./utils/cookie-jar\";\r\nimport type { ZJUAM } from \"./zjuam\";\r\n\r\nclass COURSES {\r\n  zjuamInstance: ZJUAM;\r\n  // cookies: { [key: string]: string };\r\n  session: string=\"\";\r\n  firstTime: boolean = true;\r\n  jar = createCookieJar();\r\n  constructor(am: ZJUAM) {\r\n    this.zjuamInstance = am;\r\n    // this.cookies = {};\r\n  }\r\n\r\n  async login() {\r\n    console.log(\"[COURSES] login begins\");\r\n\r\n    let currentURL = \"https://courses.zju.edu.cn/user/index\";\r\n\r\n    while(new URL(currentURL).hostname !== \"zjuam.zju.edu.cn\"){\r\n      console.log(\"[COURSES] Redirect:\", currentURL);\r\n      const res = await fetchWithCookie(currentURL, { redirect: \"manual\" }, this.jar);\r\n      currentURL = res.headers.get(\"Location\")!;\r\n    }\r\n    console.log(\"[COURSES] Redirected to ZJUAM for authentication:\", currentURL);\r\n\r\n    currentURL = await this.zjuamInstance.loginSvc(new URL(currentURL).searchParams.get(\"service\") || \"\")\r\n\r\n    console.log(\"[COURSES] Returned from ZJUAM, finalizing login at:\", currentURL);\r\n\r\n    const res =  await fetchWithCookie(currentURL, { redirect: \"manual\" }, this.jar);\r\n\r\n    while(true){\r\n      console.log(\"[COURSES] Redirect:\", currentURL);\r\n      const res = await fetchWithCookie(currentURL, { redirect: \"manual\" }, this.jar);\r\n      // console.log(res.status);\r\n      // console.log(res.headers);\r\n      // console.log(await res.text());\r\n      const content = await res.text();\r\n      if(res.status == 200 && content.includes(\"meta http-equiv=\\\"refresh\\\"\")){\r\n        currentURL =  content.match(/meta http-equiv=\"refresh\" content=\"0;URL=([^\"]+)\"/)![1];\r\n        continue;\r\n      }\r\n      if(!(res.status >= 300 && res.status < 400)) break;\r\n      currentURL = res.headers.get(\"Location\")!;\r\n    }\r\n\r\n    return true;\r\n\r\n  }\r\n\r\n  async fetch(url: string, options: any = {}): Promise<Response> {\r\n    if (this.firstTime) {\r\n      await this.login();\r\n      this.firstTime = false;\r\n    }\r\n    // console.log(\"Login finished.\",this.firstTime,this.session);\r\n\r\n    console.log(\"[COURSES] Fetching url:\", url);\r\n    \r\n    \r\n    options.headers = {\r\n      ...options?.headers,\r\n    };\r\n    return fetchWithCookie(url, options, this.jar);\r\n\r\n  }\r\n}\r\n\r\nexport { COURSES };\r\n", "import fetchWithCookie, { createCookieJar } from \"./utils/fetch-utils\";\r\nimport type { ZJUAM } from \"./zjuam\";\r\nimport { CookieJar } from \"./utils/cookie-jar\";\r\n\r\nclass ZDBK {\r\n  // the only used Cookie is \"JSESSIONPREJSDM\" and \"route\".\r\n\r\n  zjuamInstance: ZJUAM;\r\n  cookiesJar: CookieJar;\r\n  logedIn: boolean = false;\r\n  constructor(am: ZJUAM) {\r\n    this.zjuamInstance = am;\r\n    this.cookiesJar = createCookieJar();\r\n  }\r\n  async login() {\r\n    await fetchWithCookie(\r\n      \"https://zdbk.zju.edu.cn/jwglxt/xtgl/login_cxSsoLoginUrl.html\",\r\n      { method: \"POST\" },\r\n      this.cookiesJar\r\n    );\r\n\r\n    const loginCB = await this.zjuamInstance.loginSvc(\r\n      \"https://zdbk.zju.edu.cn/jwglxt/xtgl/login_ssologin.html\"\r\n    );\r\n\r\n    const res = await fetchWithCookie(loginCB, { redirect: \"manual\" }, this.cookiesJar);\r\n\r\n    if (res.status !== 302)\r\n      throw new Error(\"Login failed, status code is \" + res.status);\r\n    if (\r\n      !res.headers\r\n        .get(\"Location\")\r\n        ?.includes(\"https://zdbk.zju.edu.cn/jwglxt/xtgl/index_initMenu.html\")\r\n    ) {\r\n      throw new Error(\r\n        \"Login failed, redirect to unexpected url \" +\r\n          res.headers.get(\"Location\")\r\n      );\r\n    }\r\n    return true;\r\n  }\r\n\r\n  async fetch(url: string, init?: RequestInit) {\r\n    if (!this.logedIn) await this.login().then((v) => (this.logedIn = v));\r\n    return fetchWithCookie(\r\n      url,\r\n      {\r\n        ...init,\r\n        headers: {\r\n          ...init?.headers,\r\n        },\r\n      },\r\n      this.cookiesJar\r\n    );\r\n  }\r\n}\r\n\r\nexport { ZDBK };\r\n", "function rsaEncrypt(passwd: string, exponent: string, nHex: string): string {\r\n    let pwd = 0n;\r\n    for (const c of passwd) {\r\n        pwd = pwd * 256n + BigInt(c.charCodeAt(0));\r\n    }\r\n    const n = BigInt(\"0x\" + nHex);\r\n    const e = BigInt(\"0x\" + exponent);// \u7B11\u70B9\u89E3\u6790\uFF1A\u4E00\u5F00\u59CB\u4EE5\u4E3A10001\u662F\u5341\u8FDB\u5236\uFF0C\u8C03\u534A\u5929\u8C03\u4E0D\u5BF9\r\n    const crypt = (pwd ** e) % n;\r\n    // let crypt = 1n;\r\n    // let base = pwd % n;\r\n    // for (let i = 0n; i < e; i++) {\r\n    //     crypt = (crypt * base) % n;\r\n    //     base = (base * base) % n; \r\n    // } \r\n    const ciphertextHex = crypt.toString(16);\r\n    return ciphertextHex;\r\n}\r\nexport { rsaEncrypt };", "import { rsaEncrypt } from \"./utils/RSA\";\r\nimport fetchWithCookie, { createCookieJar } from \"./utils/fetch-utils\";\r\n\r\nconst pubkey_url = \"https://zjuam.zju.edu.cn/cas/v2/getPubKey\";\r\n\r\nclass ZJUAM {\r\n  username: string;\r\n  password: string;\r\n  jar = createCookieJar();\r\n  firstinLogin: boolean = false;\r\n\r\n  constructor(username: string, password: string) {\r\n    this.username = username;\r\n    this.password = password;\r\n  }\r\n\r\n  async #_login(login_url: string): Promise<string> {\r\n    console.log(\"[ZJUAM] Attempting to login to ZJUAM.\");\r\n\r\n    // get login page and let fetchWithCookie populate the jar\r\n    let login_html: string;\r\n    try {\r\n      login_html = await fetchWithCookie(login_url, undefined, this.jar).then((res) => res.text());\r\n    } catch (e) {\r\n      return Promise.reject({ message: \"Failed when fetch login page at first time.\" });\r\n    }\r\n\r\n    const execution = login_html.match(/name=\"execution\" value=\"([^\"]+)\"/)?.[1] ?? \"\";\r\n    if (!execution) {\r\n      return Promise.reject({ message: \"First-time login page doesn't contain execution string.\" });\r\n    }\r\n\r\n    // fetch pubkey (jar cookies will be sent automatically)\r\n    let pubkey: { modulus: string; exponent: string };\r\n    try {\r\n      pubkey = await fetchWithCookie(pubkey_url, undefined, this.jar).then((res) => res.json());\r\n    } catch (e) {\r\n      return Promise.reject({ message: \"Failed when fetch pubkey.\" });\r\n    }\r\n\r\n    const key = rsaEncrypt(this.password, pubkey.exponent, pubkey.modulus);\r\n\r\n    // perform login POST\r\n    const body = [\r\n      \"username=\" + this.username,\r\n      \"password=\" + key,\r\n      \"execution=\" + execution,\r\n      \"_eventId=\" + \"submit\",\r\n      \"authcode=\",\r\n    ].join(\"&\");\r\n\r\n    const headers = {\r\n      \"Content-Type\": \"application/x-www-form-urlencoded\",\r\n      \"User-Agent\":\r\n        \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0\",\r\n    };\r\n\r\n    try {\r\n      const res = await fetchWithCookie(login_url, { method: \"POST\", body, headers, redirect: \"manual\" }, this.jar);\r\n      if (res.status === 302) {\r\n        this.firstinLogin = true;\r\n        console.log(\"[ZJUAM] Login success.\");\r\n        return res.headers.get(\"Location\") as string;\r\n      } else if (res.status === 200) {\r\n        const text = await res.text();\r\n        const message = text.match(/<span id=\"msg\">([^<]+)<\\/span>/)?.[1];\r\n        return Promise.reject({ message: \"Failed to login: \" + message });\r\n      } else {\r\n        return Promise.reject({ message: \"Failed to login with status code \" + res.status });\r\n      }\r\n    } catch (e) {\r\n      return Promise.reject({ message: \"Failed when posting login.\" });\r\n    }\r\n  }\r\n\r\n  login() {\r\n    return this.#_login(\"https://zjuam.zju.edu.cn/cas/login\");\r\n  }\r\n\r\n  async fetch(url: string, options: RequestInit = {}) {\r\n    if (!this.firstinLogin) {\r\n      await this.login().catch((e) => {\r\n        console.error(e);\r\n      });\r\n    }\r\n\r\n    const headers = {\r\n      ...(options.headers || {}),\r\n      \"User-Agent\":\r\n        \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/131.0.0.0 Safari/537.36 Edg/131.0.0.0\",\r\n    };\r\n\r\n    return fetchWithCookie(url, { ...options, headers }, this.jar);\r\n  }\r\n\r\n  async loginSvc(service: string): Promise<string> {\r\n    console.log(\"[ZJUAM] Attempting to login to service: \" + service);\r\n\r\n    const fullLoginStr = \"https://zjuam.zju.edu.cn/cas/login?service=\" + encodeURIComponent(service);\r\n    if (this.firstinLogin) {\r\n      const res = await this.fetch(fullLoginStr, { redirect: \"manual\", method: \"GET\" });\r\n      console.log(\"loginSvc,\", res.status, res.headers.get(\"Location\"));\r\n      if (res.status === 302) {\r\n        return res.headers.get(\"Location\") as string;\r\n      } else if (res.status === 200) {\r\n        return this.#_login(fullLoginStr);\r\n      }\r\n      return Promise.reject({ message: \"Login failed with status \" + res.status });\r\n    } else {\r\n      return this.#_login(fullLoginStr);\r\n    }\r\n  }\r\n\r\n  async loginSvc_oauth2(redirectUrl: string): Promise<string> {\r\n    console.log(\"[ZJUAM] Attempting to login to oauth2 service: \" + redirectUrl);\r\n    // const res = await this.fetch(redirectUrl, { redirect: \"manual\", method: \"GET\" });\r\n    // console.log(\"loginSvc_oauth2,\", res.status, res.headers.get(\"Location\"));\r\n    let currentURL = redirectUrl;\r\n\r\n    while(new URL(currentURL).hostname === \"zjuam.zju.edu.cn\"){\r\n      console.log(\"[ZJUAM] Redirect:\", currentURL);\r\n      const res = await this.fetch(currentURL, { redirect: \"manual\", method: \"GET\" });\r\n      currentURL = res.headers.get(\"Location\")!;\r\n    }\r\n    return currentURL;\r\n  }\r\n}\r\nexport { ZJUAM };\r\n", "// \u5B66\u5728\u6D59\u5927 course.zju.edu.cn\r\n\r\nimport type { ZJUAM } from \"./zjuam\";\r\n\r\nclass COURSE {\r\n  zjuamInstance: ZJUAM;\r\n  cookies: { [key: string]: string };\r\n  constructor(am: ZJUAM, mode: \"WEB\" | \"APP\") {\r\n    this.zjuamInstance = am;\r\n    this.cookies = {};\r\n  }\r\n  token: string = \"\";\r\n  session: string;\r\n\r\n  async login() {\r\n    const callbackURL = await this.zjuamInstance.loginSvc(\r\n      \"https://course.zju.edu.cn/ua/login?platform=WEB\"\r\n    );\r\n\r\n    console.log(callbackURL);\r\n\r\n    await fetch(callbackURL, {\r\n      redirect: \"manual\",\r\n    })\r\n      .then((res) => {\r\n        console.log(res.status);\r\n        console.log(res.headers.getSetCookie());\r\n        res.headers.getSetCookie().forEach((cookieStr) => {\r\n          const [key, value] = cookieStr.split(\";\")[0].split(\"=\");\r\n          this.cookies[key] = value;\r\n        });\r\n        return res.headers.get(\"Location\");\r\n      })\r\n      .then((location) => {\r\n        return fetch(location!, {\r\n          redirect: \"manual\",\r\n          headers: {\r\n            Cookie: Object.entries(this.cookies)\r\n              .map(([key, value]) => `${key}=${value}`)\r\n              .join(\"; \"),\r\n          },\r\n        });\r\n      })\r\n      .then((res) => {\r\n        console.log(res.status);\r\n        console.log(res.headers.getSetCookie());\r\n        // res.headers.getSetCookie().forEach((cookieStr) => {\r\n        //     const [key, value] = cookieStr.split(\";\")[0].split(\"=\");\r\n        //     this.cookies[key] = value;\r\n        // });\r\n        console.log(res.headers.get(\"Location\"));\r\n        this.token = new URL(res.headers.get(\"Location\")!).searchParams.get(\r\n          \"token\"\r\n        ) as string;\r\n        // console.log(this.token);\r\n        return fetch(res.headers.get(\"Location\")!, {});\r\n      })\r\n      .then((res) => {\r\n        console.log(res.status);\r\n        console.log(res.headers.getSetCookie());\r\n        // res.headers.getSetCookie().forEach((cookieStr) => {\r\n        //     const [key, value] = cookieStr.split(\";\")[0].split(\"=\");\r\n        //     this.cookies[key] = value;\r\n        // });\r\n        console.log(res.headers.get(\"Location\"));\r\n      });\r\n  }\r\n}\r\n\r\nexport { COURSE };\r\n", "import type { ZJUAM } from \"./zjuam\";\r\nimport crypto from \"crypto\";\r\n\r\nconst service = \"https://form.zju.edu.cn/\";\r\n\r\nconst toBase64 = (str: string) => {\r\n  return Buffer.from(str).toString(\"base64\");\r\n}\r\n\r\nconst toMD5 = (str: string) => {\r\n  return crypto.createHash(\"md5\").update(str);\r\n}\r\n\r\nconst HardcodedKey = \"74102f635c6d4b22b270239bc1e84f50\"; // md5(\"zntb666666666666\")\r\n\r\nconst form_encode = (data: string) => {\r\n  const cipher = crypto.createCipheriv(\"aes-128-ecb\", Buffer.from(HardcodedKey, \"hex\"), null);\r\n  let encrypted = cipher.update(data, \"utf8\", \"base64\");\r\n  encrypted += cipher.final(\"base64\");\r\n  \r\n  return toBase64(encrypted);\r\n}\r\n\r\nclass FORM {\r\n  token: string = \"\";\r\n  zjuamInstance: ZJUAM;\r\n  constructor(am: ZJUAM) {\r\n    this.zjuamInstance = am;\r\n  }\r\n  async login() {\r\n    console.log(\"[FORM] login begins\");\r\n    return this.zjuamInstance\r\n      .loginSvc(service)\r\n      .then((callbackURL) => {\r\n        const ticket = callbackURL.split(\"ticket=\")[1].split(\"&\")[0];\r\n        return fetch(\r\n          `https://form.zju.edu.cn/dfi/validateLogin?ticket=${form_encode(ticket)}&service=${encodeURIComponent(\r\n            service\r\n          )}`\r\n        );\r\n      })\r\n      .then((r) => r.json())\r\n      .then((r) => {\r\n        // console.log(r);\r\n        if (r.code === 2000) {\r\n          console.log(\"[FORM] login success\");\r\n          this.token = r.data.token;\r\n          return true;\r\n        }else{\r\n          throw new Error(\"[FORM] login failed\",r);\r\n        }\r\n      })\r\n      .catch((e) => {\r\n        throw e;\r\n      });\r\n  }\r\n\r\n  async fetch(url: string): Promise<Response> {\r\n    if (this.token === \"\") {\r\n      await this.login();\r\n    }\r\n    try {\r\n      const res = await fetch(url!, {\r\n        headers: {\r\n            authentication: this.token,\r\n        },\r\n      });\r\n      if (res.status === 200) {\r\n        return res;\r\n      } else {\r\n        if (res.status === 401 || res.status === 403) {\r\n          this.token = \"\";\r\n          return this.fetch(url);\r\n        }\r\n        throw new Error(`Request failed with status ${res.status}`);\r\n      }\r\n    } catch (error) {\r\n      console.error(\"Fetch error:\", error);\r\n\r\n      throw error;\r\n    }\r\n  }\r\n}\r\n\r\nexport { FORM };\r\n", "import fetchWithCookie, { createCookieJar } from \"./utils/fetch-utils\"\r\nimport type { ZJUAM } from \"./zjuam\";\r\n\r\nclass CLASSROOM {\r\n  zjuamInstance: ZJUAM;\r\n  token = \"\";\r\n  jar = createCookieJar();\r\n  constructor(am: ZJUAM) {\r\n    this.zjuamInstance = am;\r\n  }\r\n\r\n  async login() {\r\n    console.log(\r\n      \"[CLASSROOM] Attempting to login to classroom.zju.edu.cn\"\r\n    );\r\n\r\n    let currentURL = \"https://tgmedia.cmc.zju.edu.cn/index.php?r=auth%2Flogin&forward=https%3A%2F%2Fclassroom.zju.edu.cn%2F\";\r\n\r\n    while(new URL(currentURL).hostname !== \"zjuam.zju.edu.cn\"){\r\n      console.log(\"[CLASSROOM] Redirect:\", currentURL);\r\n      const res = await fetchWithCookie(currentURL, { redirect: \"manual\" }, this.jar);\r\n      currentURL = res.headers.get(\"Location\")!;\r\n    }\r\n\r\n    console.log(\"[CLASSROOM] Redirected to ZJUAM for authentication:\", currentURL);\r\n\r\n    currentURL = await this.zjuamInstance.loginSvc_oauth2(currentURL);\r\n\r\n    console.log(\"[CLASSROOM] Returned from ZJUAM, finalizing login at:\", currentURL);\r\n\r\n    while(true){\r\n      console.log(\"[CLASSROOM] Redirect:\", currentURL);\r\n      const res = await fetchWithCookie(currentURL, { redirect: \"manual\" }, this.jar);\r\n      const content = await res.text();\r\n      if(res.status == 200 && content.includes(\"meta http-equiv=\\\"refresh\\\"\")){\r\n        currentURL =  content.match(/meta http-equiv=\"refresh\" content=\"0;URL=([^\"]+)\"/)![1];\r\n        continue;\r\n      }\r\n      if(!(res.status >= 300 && res.status < 400)) break;\r\n      currentURL = res.headers.get(\"Location\")!;\r\n    }\r\n\r\n    // // return this.session.then(async (session) => {\r\n    //   await this.session\r\n    //     .fetch(\r\n    //       \"https://tgmedia.cmc.zju.edu.cn/index.php?r=auth%2Flogin&forward=https%3A%2F%2Fclassroom.zju.edu.cn%2F\",\r\n    //       {\r\n    //         redirect: \"manual\",\r\n    //       }\r\n    //     )\r\n    //     .then(async (response) => {\r\n    //       if (response.status === 302) {\r\n    //         // console.log(\"[CLASSROOM] Redirecting to:\", response.headers.get(\"Location\"));\r\n    //         return response.headers.get(\"Location\") as string;\r\n    //       } else {\r\n    //         throw new Error(\"Failed to login\");\r\n    //       }\r\n    //     })\r\n    //     .then(async (redirectUrl) => {\r\n    //       // things like                 https://zjuam.zju.edu.cn/cas/oauth2.0/authorize?response_type=code&client_id=Oaaaaaaaaaaaaaaa&redirect_uri=http://tgmedia.cmc.zju.edu.cn/index.php?r=auth/get-info&url=https://classroom.zju.edu.cn/\r\n    //       return this.zjuamInstance.loginSvc_oauth2(redirectUrl);\r\n    //     })\r\n    //     .then(async (callbackURL) => {\r\n    //       /*\r\n    //        *    Here there is a redirect\r\n    //        *\r\n    //        *     -> http://tgmedia.cmc.zju.edu.cn/index.php?r=auth/get-info&code=ST-2848273-yrnApl2GCwUZrd6ErCXt-zju.edu.cn\r\n    //        *     -> https://tgmedia.cmc.zju.edu.cn/index.php?r=auth/get-info&code=ST-2848273-yrnApl2GCwUZrd6ErCXt-zju.edu.cn\r\n    //        *     -> https://classroom.zju.edu.cn\r\n    //        *\r\n    //        *     That is stupid. I'm not sure will we follow it or the behavior will change.\r\n    //        */\r\n\r\n    //       if (callbackURL.startsWith(\"http://\")) {\r\n    //         callbackURL = callbackURL.replace(\"http://\", \"https://\");\r\n    //       }\r\n\r\n    //       return this.session\r\n    //         .fetch(callbackURL, {\r\n    //           redirect: \"manual\",\r\n    //         })\r\n    //         .then(async (response) => {\r\n    //           if (response.status === 302) {\r\n    //             // console.log(\"[CLASSROOM] Redirecting to:\", response.headers.get(\"Location\"));\r\n    //             // console.log(\"[CLASSROOM] Cookies:\", response.headers.getSetCookie());\r\n    //             return response.headers.get(\"Location\") as string;\r\n    //           } else {\r\n    //             throw new Error(\"Failed to login\");\r\n    //           }\r\n    //         });\r\n    //     });\r\n\r\n    //   const token = decodeURIComponent(\r\n    //     this.session.extractCookie(\r\n    //       new URL(\"https://tgmedia.cmc.zju.edu.cn/\").origin,\r\n    //       \"_token\"\r\n    //     )\r\n    //   );\r\n    //   // console.log(token);\r\n    //   // 784834b3512089de67d5438a50f8cf416a32e42e93f9cad734cb06f11e2cbb81a:2:{i:0;s:6:\"_token\";i:1;s:677:\"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJhY2N*********************************************************oxMTJ9.BPC15h1zPU3*************************FWUCehA\";}\r\n\r\n    //   // I'm using pattern match to parse the token. We need the JWT part.\r\n    //   // We must assure the format of the token is consistent.\r\n\r\n    //   // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n    //   // This part is down once the format of token is changed!\r\n    //   // Once the code failed to run. Inspect it!!!!!!\r\n    //   this.token = token\r\n    //     .split(\":\")\r\n    //     .filter((c) => c.startsWith('\"ey'))[0]\r\n    //     .split('\"')[1];\r\n    //   // !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!\r\n    //   console.log(\"[CLASSROOM] Login successful.\");\r\n      return;\r\n  }\r\n\r\n  async fetch(url: string, options: RequestInit = {}) {\r\n    if (!this.token || this.token.length === 0) {\r\n      await this.login();\r\n    }\r\n    console.log(\"[CLASSROOM] Fetching:\", url);\r\n    // console.log(\"[CLASSROOM] Cookies:\", this.session.allCookies);\r\n\r\n    const headers = {\r\n      ...options.headers,\r\n      Authorization: `Bearer ${this.token}`,\r\n    };\r\n\r\n    return fetchWithCookie(url, { ...options, headers }, this.jar);\r\n  }\r\n}\r\n\r\nexport { CLASSROOM };\r\n"],
  "mappings": "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",
  "names": ["CookieAccessInfo", "domain", "path", "secure", "script", "cookie_str_splitter", "Cookie", "_Cookie", "cookiestr", "request_domain", "request_path", "str", "parts", "firstPair", "key", "value", "pair", "access_info", "access_domain", "cookie_domain", "wildcard", "CookieJar", "cookie", "c", "remove", "name", "existing", "cookie_name", "list", "i", "matches", "cookies", "items", "successful", "prepared", "item", "createCookieJar", "CookieJar", "headersToObject", "headers", "out", "k", "v", "val", "fetchWithCookie", "input", "init", "jar", "cookieJar", "url", "parsed", "domain", "path", "providedHeaders", "access", "CookieAccessInfo", "cookies", "cookieHeader", "c", "existing", "finalInit", "res", "setCookies", "name", "value", "sc", "e", "fetch_utils_default", "COURSES", "createCookieJar", "am", "currentURL", "fetch_utils_default", "res", "content", "url", "options", "ZDBK", "am", "createCookieJar", "fetch_utils_default", "loginCB", "res", "url", "init", "v", "rsaEncrypt", "passwd", "exponent", "nHex", "pwd", "c", "e", "pubkey_url", "ZJUAM", "createCookieJar", "username", "password", "#_login", "login_url", "login_html", "fetch_utils_default", "res", "execution", "pubkey", "key", "rsaEncrypt", "body", "headers", "message", "url", "options", "e", "service", "fullLoginStr", "redirectUrl", "currentURL", "COURSE", "am", "mode", "callbackURL", "res", "cookieStr", "key", "value", "location", "crypto", "service", "toBase64", "str", "HardcodedKey", "form_encode", "data", "cipher", "crypto", "encrypted", "toBase64", "FORM", "am", "service", "callbackURL", "ticket", "r", "e", "url", "res", "error", "CLASSROOM", "createCookieJar", "am", "currentURL", "fetch_utils_default", "res", "content", "url", "options", "headers"]
}
